"use strict";(self.webpackChunkbaemin_fe=self.webpackChunkbaemin_fe||[]).push([[383],{3917:function(e,r,t){function n(e){return function(r){var t,n=(i=(0,u.q)()).isLoggedIn,i=i.userInfo,o=(0,c.TH)();return n?(n=r.children,t=r.userRole,i=i.role,(Array.isArray(t)?t.includes(i):i===t)||"/"===o.pathname?(0,s.jsx)(e,(0,a.Z)((0,a.Z)({},(0,a.Z)({},r)),{},{children:n})):(0,s.jsx)(c.Fg,{to:"/",replace:!0})):(0,s.jsx)(c.Fg,{to:"/login",replace:!0})}}t.d(r,{Kf:function(){return i}});var a=t(1413),u=t(6885),c=(t(2791),t(7689)),s=t(184),i=n((function(e){return e.children}));n((function(e){return e.children}))},1039:function(e,r,t){function n(e){var r=e.children,t=e.onEndReached,n=void 0===(c=e.threshold)?10:c,c=e.className,s=e.data,i=e.renderItem;e=a.useCallback((function(e){var r=(e=e.currentTarget).scrollHeight,a=e.scrollTop;r<e.clientHeight+a+n&&"function"==typeof t&&t()}),[t]);return(0,u.jsxs)("div",{className:"scroll-view overflow-x-hidden overflow-y-scroll ".concat(c||""),onScroll:e,children:[s.map((function(e){return i(e)})),r]})}t.d(r,{Z:function(){return c}});var a=t(2791),u=t(184);n.defaultProps={threshold:100,onEndReached:void 0,className:""};var c=a.memo(n)},6885:function(e,r,t){t.d(r,{q:function(){return n.q}});var n=t(208)},8642:function(e,r,t){function n(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:2e3;return new Promise((function(r){return setTimeout(r,e)}))}function a(e,r){return Math.random()*(r-e)+e}t.d(r,{Sx:function(){return l},d4:function(){return p}});var u=t(4165),c=t(1413),s=t(5861),i=t(6885),o=t(3081),f=t(2791),d=t(7796),p=function(){var e=(0,i.q)().userInfo.id,r=(0,o.PD)();f.useEffect((function(){d.Z.on("updated-order-status-to-customer-".concat(e),function(){var e=(0,s.Z)((0,u.Z)().mark((function e(t){var s,i;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.mutateAsync(t);case 2:return s=e.sent,e.next=5,n(a(1e3,5e3));case 5:return e.next=7,r.mutateAsync((0,c.Z)((0,c.Z)({},s),{},{status:"DriverAssigned",updatedTime:new Date((new Date).toUTCString()).toString()}));case 7:i=e.sent,d.Z.emit("assign-order-to-driver",i);case 9:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}())}),[])},l=function(){var e=(0,i.q)().userInfo.id,r=(0,o.PD)();f.useEffect((function(){d.Z.on("driver-delivering-order-".concat(e),function(){var e=(0,s.Z)((0,u.Z)().mark((function e(t){return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.mutateAsync(t);case 2:return e.next=4,n(a(1e3,5e3));case 4:return e.next=6,r.mutateAsync((0,c.Z)((0,c.Z)({},t),{},{status:"Done",updatedTime:new Date((new Date).toUTCString()).toString()}));case 6:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}())}),[])}},5590:function(e,r,t){t.d(r,{LV:function(){return l},zk:function(){return h},Cs:function(){return v}});var n=t(1413),a=t(4165),u=t(5861),c=t(5671),s=t(3144),i=t(9073),o=function(){function e(r){(0,c.Z)(this,e),this.database=void 0,this.db=void 0,this.database=r}var r,t,n,o,f,d,p,l,h;return(0,s.Z)(e,[{key:"createObjectStore",value:(h=(0,u.Z)((0,a.Z)().mark((function e(r){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.X3(this.database,1,{upgrade:function(e){r.forEach((function(r){e.objectStoreNames.contains(r)||e.createObjectStore(r,{autoIncrement:!0,keyPath:"id"})}))}});case 2:return this.db=e.sent,e.abrupt("return",this);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return h.apply(this,arguments)})},{key:"getRecord",value:(l=(0,u.Z)((0,a.Z)().mark((function e(r,t){var n;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=(n=(n=this.db).transaction(r,"readonly")).objectStore(r),e.next=5,n.get(t);case 5:return n=e.sent,e.abrupt("return",n);case 7:case"end":return e.stop()}}),e,this)}))),function(e,r){return l.apply(this,arguments)})},{key:"getAllRecord",value:(p=(0,u.Z)((0,a.Z)().mark((function e(r){var t;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=(t=(t=this.db).transaction(r,"readonly")).objectStore(r),e.next=5,t.getAll();case 5:if(e.t0=e.sent,e.t0){e.next=8;break}e.t0=[];case 8:return t=e.t0,e.abrupt("return",t);case 10:case"end":return e.stop()}}),e,this)}))),function(e){return p.apply(this,arguments)})},{key:"addRecord",value:(d=(0,u.Z)((0,a.Z)().mark((function e(r,t){var n;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=(n=(n=this.db).transaction(r,"readwrite")).objectStore(r),e.next=5,n.add(t);case 5:return n=e.sent,e.abrupt("return",n);case 7:case"end":return e.stop()}}),e,this)}))),function(e,r){return d.apply(this,arguments)})},{key:"addRecordByKey",value:(f=(0,u.Z)((0,a.Z)().mark((function e(r,t,n){var u;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u=(u=(u=this.db).transaction(r,"readwrite")).objectStore(r),e.next=5,u.add(t,n);case 5:return u=e.sent,e.abrupt("return",u);case 7:case"end":return e.stop()}}),e,this)}))),function(e,r,t){return f.apply(this,arguments)})},{key:"putBulkRecord",value:(o=(0,u.Z)((0,a.Z)().mark((function e(r,t){var n,u;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u=(u=this.db).transaction(r,"readwrite"),n=u.objectStore(r),u=t.map((function(e){return n.add(e)})),e.next=6,Promise.all(u);case 6:return e.abrupt("return",this.getAllRecord(r));case 7:case"end":return e.stop()}}),e,this)}))),function(e,r){return o.apply(this,arguments)})},{key:"updateByKey",value:(n=(0,u.Z)((0,a.Z)().mark((function e(r,t){var n;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=(n=(n=this.db).transaction(r,"readwrite")).objectStore(r),e.next=5,n.put(t);case 5:return n=e.sent,e.abrupt("return",n);case 7:case"end":return e.stop()}}),e,this)}))),function(e,r){return n.apply(this,arguments)})},{key:"deleteRecord",value:(t=(0,u.Z)((0,a.Z)().mark((function e(r,t){var n,u;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=(n=(n=this.db).transaction(r,"readwrite")).objectStore(r),e.next=5,n.get(t);case 5:if(u=e.sent){e.next=8;break}return e.abrupt("return",u);case 8:return e.next=10,n.delete(t);case 10:return e.abrupt("return",t);case 11:case"end":return e.stop()}}),e,this)}))),function(e,r){return t.apply(this,arguments)})},{key:"clearTable",value:(r=(0,u.Z)((0,a.Z)().mark((function e(r){var t;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=(t=(t=this.db).transaction(r,"readwrite")).objectStore(r),e.next=5,t.clear();case 5:return t=e.sent,e.abrupt("return",t);case 7:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})}]),e}(),f="order",d="baemin-".concat(f),p=function(){var e=(0,u.Z)((0,a.Z)().mark((function e(){var r,t;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=new o(d),t=[f],e.next=4,r.createObjectStore(t);case 4:return r=e.sent,e.abrupt("return",r);case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),l=function(){var e=(0,u.Z)((0,a.Z)().mark((function e(r){var t;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p();case 2:return t=e.sent,e.next=5,t.addRecord(f,r);case 5:return t=e.sent,e.abrupt("return",t);case 7:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}(),h=function(){var e=(0,u.Z)((0,a.Z)().mark((function e(){var r;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p();case 2:return r=e.sent,e.next=5,r.getAllRecord(f);case 5:return r=e.sent,e.abrupt("return",r||[]);case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),v=function(){var e=(0,u.Z)((0,a.Z)().mark((function e(r){var t;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p();case 2:return t=e.sent,e.next=5,t.updateByKey(f,(0,n.Z)({},r));case 5:return t=e.sent,e.abrupt("return",t);case 7:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}()},8286:function(e,r,t){t.d(r,{AN:function(){return h},KS:function(){return p},PD:function(){return d},hQ:function(){return f},xv:function(){return l}});var n=t(4165),a=t(5861),u=t(7408),c=t(763),s=t(6885),i=t(5590),o=t(5006),f=function(){var e=(0,u.useQueryClient)();return(0,u.useMutation)(function(){var e=(0,a.Z)((0,n.Z)().mark((function e(r){var t;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,o._O)(r);case 2:return t=(t=e.sent).data,e.next=6,(0,i.LV)(t);case 6:return e.abrupt("return",t);case 7:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}(),{onSuccess:function(){e.invalidateQueries(["order-history"])}})},d=function(){var e=(0,u.useQueryClient)();return(0,u.useMutation)(function(){var e=(0,a.Z)((0,n.Z)().mark((function e(r){return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,i.Cs)(r);case 2:return e.abrupt("return",r);case 3:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}(),{onSuccess:function(){e.invalidateQueries(["order-history"])}})},p=function(){var e;return(0,u.useQuery)({queryKey:["order-history"],queryFn:(e=(0,a.Z)((0,n.Z)().mark((function e(){var r;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,i.zk)();case 2:return r=e.sent,e.abrupt("return",r);case 4:case"end":return e.stop()}}),e)}))),function(){return e.apply(this,arguments)})})},l=function(){var e=(0,s.q)().userInfo,r=void 0===(r=p().data)?[]:r;return{orders:(0,c.orderBy)(r.filter((function(r){return r.userId===e.id})),(function(e){return e.createdTime}),"desc")}},h=function(){var e;return(0,u.useQuery)({queryKey:["order-status-list"],queryFn:(e=(0,a.Z)((0,n.Z)().mark((function e(){var r;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,o.Bw)();case 2:return r=e.sent,e.abrupt("return",r.data);case 4:case"end":return e.stop()}}),e)}))),function(){return e.apply(this,arguments)})})}},5006:function(e,r,t){t.d(r,{Bw:function(){return u},_O:function(){return a}});r=t(5824);var n=new(t(7928).Z)({baseURL:"".concat(r.V.REACT_APP_API_DOMAIN_URL,"/order")}),a=function(e){return n.put("",e)},u=function(){return n.get("status-list")}},3081:function(e,r,t){function n(e){var r=e.order,t=e.onClickOrderItem,n=(e=r.id,r.orderName),o=r.status,f=r.createdTime,d=r.totalPrice,p=r.paymentMethod,l=r.dishes,h=a.useMemo((function(){switch(o){case"Done":return(0,i.jsx)("i",{className:"fa-solid fa-circle-check"});case"Canceled":return(0,i.jsx)("i",{className:"fa-solid fa-triangle-exclamation"});default:return(0,i.jsx)("i",{className:"fa-solid fa-spinner fa-spin"})}}),[o]);return(0,i.jsxs)(s.rU,{className:"order-item bg-primary-light p-4 border-b-[0.5px] grid items-center gap-1",onClick:function(e){e.preventDefault(),"function"==typeof t&&t(r)},to:"/order?orderId=".concat(e),children:[(0,i.jsxs)("div",{className:"block-info",children:[(0,i.jsxs)("div",{className:"block-status grid gap-2 items-center text-xs mb-1 text-primary-gray",children:[h,(0,i.jsx)("span",{className:"font-medium",children:o}),(0,i.jsx)("span",{children:(h=f,c()(h).format("DD/MM/YYYY-hh:mm a"))})]}),(0,i.jsx)("div",{className:"mb-2",children:n}),(0,i.jsxs)("div",{className:"block-payment text-xs text-primary-gray",children:[(0,i.jsx)("span",{children:(0,u.e)({value:d})}),(0,i.jsxs)("span",{className:"mx-1",children:["(",p,")"]}),(0,i.jsxs)("span",{children:[l.length," Items"]}),(0,i.jsxs)("span",{className:"ml-1 font-medium",children:["#",function(e){var r=e.str,t=void 0===(t=e.limit)?10:t;e=void 0===(e=e.dots)?"...":e;try{var n=r.length;return n<2*t+e.length?r:r.substring(0,t)+e+r.substring(n-t,n)}catch(e){return r}}({str:e,limit:5})]})]})]}),(0,i.jsx)("i",{className:"fa-solid fa-chevron-right text-primary-gray"})]})}t.d(r,{ZP:function(){return f},PD:function(){return o.PD},KS:function(){return o.KS},AN:function(){return o.AN},xv:function(){return o.xv}});var a=t(2791),u=t(4280),c=(r=t(7892),t.n(r)),s=t(1087),i=t(184),o=(r=(n.defaultProps={onClickOrderItem:void 0},a.memo(n)),t(5590),t(5006),t(8286)),f=r},7796:function(e,r,t){var n=t(5824);t=(0,t(4123).io)(n.V.REACT_APP_WS_PATH);r.Z=t},4280:function(e,r,t){t.d(r,{e:function(){return n}});var n=function(e){var r=e.locales,t=e.value;e=e.currency;return new Intl.NumberFormat(void 0===r?"vi-VN":r,{style:"currency",currency:void 0===e?"VND":e}).format(t)}}}]);